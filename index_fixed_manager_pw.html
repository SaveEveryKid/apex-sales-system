<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Apex Sales System</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Inter','SF Pro',system-ui,sans-serif;background:#2B2D31;color:#E8E8E8;line-height:1.7;font-size:18px}
    h1{font-size:42px;font-weight:600;letter-spacing:-0.02em;line-height:1.2}
    h2{font-size:32px;font-weight:500;margin-bottom:1.2em}
    h3{font-size:22px;font-weight:600;margin-bottom:.8em}
    p{margin-bottom:1.2em}
    .meta{font-size:14px;color:#9B9B9B}
    .container{max-width:1200px;margin:0 auto;padding:0 40px}
    .content-narrow{max-width:760px;margin:0 auto}
    section{padding:96px 0}
    header{background:rgba(43,45,49,0.95);backdrop-filter:blur(10px);position:sticky;top:0;z-index:1000;border-bottom:1px solid rgba(155,155,155,0.1)}
    nav{display:flex;justify-content:space-between;align-items:center;padding:18px 40px}
    .logo{font-size:14px;font-weight:700;letter-spacing:.08em;text-transform:uppercase}
    .nav-links{display:flex;gap:26px;list-style:none;flex-wrap:wrap;justify-content:flex-end}
    .nav-links a{color:#9B9B9B;text-decoration:none;font-size:14px;transition:color 200ms ease}
    .nav-links a:hover,.nav-links a.active{color:#E8E8E8}
    .hero{text-align:center;padding:140px 0 96px}
    .hero-divider{width:200px;height:1px;background:#9B9B9B;margin:28px auto}
    .hero-subtitle{font-size:20px;color:#9B9B9B}
    .hero-tagline{font-size:14px;color:#9B9B9B;margin-top:14px;font-style:italic}
    .btn{display:inline-block;padding:14px 28px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);color:#E8E8E8;text-decoration:none;font-size:16px;transition:all 200ms ease;cursor:pointer}
    .btn:hover:not(:disabled){background:rgba(255,255,255,.08);border-color:rgba(255,255,255,.2)}
    .btn:disabled{opacity:.35;cursor:not-allowed}
    .btn-primary{background:rgba(91,124,153,.22);border-color:#5B7C99}
    .btn-primary:hover:not(:disabled){background:rgba(91,124,153,.32)}
    blockquote{background:rgba(255,255,255,.02);border-left:2px solid #5B7C99;padding:28px;margin:26px 0;font-style:italic}
    .systems-grid{display:grid;gap:22px;margin-top:54px}
    .system-card{background:rgba(255,255,255,.03);border:1px solid rgba(155,155,155,.12);padding:34px;transition:border-color 200ms ease}
    .system-card:hover{border-color:rgba(155,155,155,.22)}
    .card-header{display:flex;align-items:center;gap:14px;margin-bottom:18px}
    .card-icon{font-size:30px}
    .card-title{font-size:22px;font-weight:700}
    .card-description{color:#9B9B9B;margin-bottom:10px}
    .card-status{font-size:14px;color:#9B9B9B;font-style:italic}
    .toolbar{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin:22px 0 0}
    .input{padding:12px 14px;background:rgba(255,255,255,.04);border:1px solid rgba(155,155,155,.18);color:#E8E8E8;width:min(420px,100%);outline:none}
    .pill{padding:8px 12px;border:1px solid rgba(155,155,155,.18);background:rgba(255,255,255,.03);color:#9B9B9B;font-size:14px}
    .page.hidden{display:none}
    .fade-in{animation:fadeIn 260ms ease-in}
    @keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
    /* Daily layout */
    .daily-layout{display:grid;grid-template-columns:260px 1fr;gap:64px;padding:48px 40px}
    .sidebar{position:sticky;top:92px;height:fit-content}
    .day-counter{font-size:46px;font-weight:700;margin-bottom:18px;color:#5B7C99}
    .progress-ring{width:120px;height:120px;margin-bottom:22px}
    .day-list{list-style:none;max-height:58vh;overflow:auto;padding-right:6px}
    .day-list-item{padding:8px 0;color:#9B9B9B;font-size:14px;cursor:pointer}
    .day-list-item.completed{color:#5B7C99}
    .day-list-item.current{color:#E8E8E8;font-weight:700}
    .daily-content{max-width:760px}
    .content-block{margin-bottom:40px}
    .content-block h4{color:#5B7C99;font-size:13px;text-transform:uppercase;letter-spacing:.12em;margin-bottom:10px}
    .content-block ul{margin-left:22px;margin-bottom:1.2em}
    .quote{font-style:italic;color:#9B9B9B;padding-left:20px;border-left:2px solid #5B7C99;margin:16px 0}
    .nav-controls{display:flex;justify-content:space-between;align-items:center;margin-top:54px;padding-top:26px;border-top:1px solid rgba(155,155,155,.12);gap:12px;flex-wrap:wrap}
    .checkbox-label{display:flex;align-items:center;gap:10px;cursor:pointer;font-size:16px}
    .checkbox-label input{width:18px;height:18px}
    /* Chapters */
    .two-col{display:grid;grid-template-columns:320px 1fr;gap:42px}
    .list{list-style:none;border:1px solid rgba(155,155,155,.12);background:rgba(255,255,255,.02)}
    .list li{padding:14px 14px;border-bottom:1px solid rgba(155,155,155,.10);cursor:pointer;color:#9B9B9B}
    .list li:hover{color:#E8E8E8}
    .list li.active{color:#E8E8E8;background:rgba(255,255,255,.03);font-weight:700}
    .panel{border:1px solid rgba(155,155,155,.12);background:rgba(255,255,255,.02);padding:22px}
    footer{border-top:1px solid rgba(155,155,155,.12);padding:46px 40px;text-align:center;font-size:14px;color:#9B9B9B}
    /* Modal */
    .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.88);z-index:2000;align-items:center;justify-content:center}
    .modal.active{display:flex}
    .modal-content{background:#2B2D31;border:1px solid rgba(155,155,155,.25);max-width:520px;padding:40px;text-align:center}
    .modal-actions{display:flex;gap:12px;justify-content:center;margin-top:18px;flex-wrap:wrap}
    .warn{color:#D08B8B}
  </style>
</head>
<body>
<header>
  <nav>
    <div class="logo">The Apex Sales System</div>
    <ul class="nav-links">
      <li><a href="#home" class="active nav-link" data-page="home">Home</a></li>
      <li><a href="#apex" class="nav-link" data-page="apex">Apex Training</a></li>
      <li><a href="#persuasion" class="nav-link" data-page="persuasion">Deep Persuasion</a></li>
      <li><a href="#appointment" class="nav-link" data-page="appointment">Appointment</a></li>
      <li><a href="#authority" class="nav-link" data-page="authority">Final Authority</a></li>
    </ul>
  </nav>
</header>

<main id="app">
  <!-- HOME -->
  <div id="page-home" class="page">
    <section class="hero">
      <div class="container">
        <h1>THE APEX SALES SYSTEM</h1>
        <div class="hero-divider"></div>
        <p class="hero-subtitle">Human Decision Architecture</p>
        <p class="hero-tagline">Train perception. Preserve agency. Apply authority only when earned.</p>

        <div class="systems-grid content-narrow">
          <div class="system-card">
            <div class="card-header"><div class="card-icon">üî∞</div><div class="card-title">APEX TRAINING</div></div>
            <p class="card-description">90-day devotional for the entire team.</p>
            <p class="card-status">Open to everyone</p>
            <button class="btn btn-primary" data-jump="apex">Enter Apex</button>
          </div>

          <div class="system-card">
            <div class="card-header"><div class="card-icon">üéØ</div><div class="card-title">DEEP PERSUASION</div></div>
            <p class="card-description">Decision architecture for sales teams.</p>
            <p class="card-status">Open to everyone</p>
            <button class="btn btn-primary" data-jump="persuasion">Enter Deep Persuasion</button>
          </div>

          <div class="system-card">
            <div class="card-header"><div class="card-icon">üö™</div><div class="card-title">THE APPOINTMENT IS THE DECISION</div></div>
            <p class="card-description">Internet-manager playbook for appointment conversion.</p>
            <p class="card-status">Open to everyone</p>
            <button class="btn btn-primary" data-jump="appointment">Enter Appointment</button>
          </div>

          <div class="system-card">
            <div class="card-header"><div class="card-icon">‚öñÔ∏è</div><div class="card-title">FINAL AUTHORITY</div></div>
            <p class="card-description">Managers-only indecision termination.</p>
            <p class="card-status">üîí Password required</p>
            <button class="btn btn-primary" data-jump="authority">Enter Final Authority</button>
          </div>
        </div>
      </div>
    </section>

    <section>
      <div class="container">
        <div class="content-narrow">
          <blockquote>
            <p><strong>This is not a sales course.</strong></p>
            <p>This is a training environment designed to rewire how your team perceives, decides, and leads.</p>
          </blockquote>
          <p class="meta" id="load-status">Loading content‚Ä¶</p>
        </div>
      </div>
    </section>
  </div>

  <!-- APEX -->
  <div id="page-apex" class="page hidden">
    <section class="hero" style="padding:110px 0 60px;">
      <div class="container">
        <div style="text-align:center;">
          <div style="font-size:48px;margin-bottom:12px;">üî∞</div>
          <h1>APEX TRAINING</h1>
          <div class="hero-divider"></div>
          <p class="hero-subtitle">90-Day Devotional</p>
          <p class="hero-tagline">One day. One rep. Apply it in the real world.</p>

          <div class="toolbar" style="justify-content:center;">
            <button class="btn btn-primary" id="start-day-1">Begin Day 1</button>
            <span class="pill" id="apex-count">Days loaded: 0</span>
          </div>
        </div>
      </div>
    </section>

    <section style="padding-top:0;">
      <div class="container">
        <div class="content-narrow">
          <h2>How to use this</h2>
          <ul style="margin-left:22px;">
            <li>Do one day per workday. Don‚Äôt binge.</li>
            <li>Mark complete after you apply it live.</li>
            <li>Use search to find a day later.</li>
          </ul>
          <p class="meta">Tip: If this page says ‚ÄúDays loaded: 0‚Äù, your JSON isn‚Äôt being found.</p>
        </div>
      </div>
    </section>
  </div>

  <!-- DAILY -->
  <div id="page-daily" class="page hidden">
    <div class="daily-layout">
      <div class="sidebar">
        <div class="day-counter" id="current-day-display">DAY 1</div>
        <svg class="progress-ring" viewBox="0 0 120 120">
          <circle cx="60" cy="60" r="54" fill="none" stroke="rgba(155,155,155,0.12)" stroke-width="4"/>
          <circle id="progress-circle" cx="60" cy="60" r="54" fill="none" stroke="#5B7C99" stroke-width="4"
                  stroke-dasharray="339.292" stroke-dashoffset="339.292" transform="rotate(-90 60 60)"/>
        </svg>
        <input class="input" id="day-search" placeholder="Search days‚Ä¶" />
        <ul class="day-list" id="day-list"></ul>
      </div>

      <div class="daily-content" id="daily-content"></div>
    </div>
  </div>

  <!-- DEEP PERSUASION -->
  <div id="page-persuasion" class="page hidden">
    <section class="hero" style="padding:110px 0 60px;">
      <div class="container" style="text-align:center;">
        <div style="font-size:48px;margin-bottom:12px;">üéØ</div>
        <h1>DEEP PERSUASION</h1>
        <div class="hero-divider"></div>
        <p class="hero-subtitle">Sales Team System</p>
        <p class="hero-tagline">Guide decisions. Never override them.</p>
      </div>
    </section>
    <section style="padding-top:0;">
      <div class="container">
        <div class="two-col">
          <div>
            <input class="input" id="pers-search" placeholder="Search chapters‚Ä¶" />
            <ul class="list" id="pers-list"></ul>
          </div>
          <div class="panel" id="pers-panel">
            <p class="meta">Select a chapter.</p>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- APPOINTMENT -->
  <div id="page-appointment" class="page hidden">
    <section class="hero" style="padding:110px 0 60px;">
      <div class="container" style="text-align:center;">
        <div style="font-size:48px;margin-bottom:12px;">üö™</div>
        <h1>THE APPOINTMENT IS THE DECISION</h1>
        <div class="hero-divider"></div>
        <p class="hero-subtitle">Internet Manager Playbook</p>
        <p class="hero-tagline">Open the gates in order. Nothing else works.</p>
      </div>
    </section>
    <section style="padding-top:0;">
      <div class="container">
        <div class="two-col">
          <div>
            <input class="input" id="appt-search" placeholder="Search chapters‚Ä¶" />
            <ul class="list" id="appt-list"></ul>
          </div>
          <div class="panel" id="appt-panel">
            <p class="meta">Select a chapter.</p>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- FINAL AUTHORITY -->
  <div id="page-authority" class="page hidden">
    <section class="hero" style="padding:110px 0 60px;">
      <div class="container" style="text-align:center;">
        <div style="font-size:48px;margin-bottom:12px;">‚öñÔ∏è</div>
        <h1>FINAL AUTHORITY</h1>
        <div class="hero-divider"></div>
        <p class="hero-subtitle">Managers Training</p>
        <p class="hero-tagline">Force is ethical only when applied last.</p>
        <p class="meta warn">Managers Only ‚Äî password required</p>
      </div>
    </section>
    <section style="padding-top:0;">
      <div class="container">
        <div class="two-col">
          <div>
            <input class="input" id="auth-search" placeholder="Search chapters‚Ä¶" />
            <ul class="list" id="auth-list"></ul>
          </div>
          <div class="panel" id="auth-panel">
            <p class="meta">Select a chapter.</p>
          </div>
        </div>
      </div>
    </section>
  </div>
</main>

<div class="modal" id="manager-modal">
  <div class="modal-content">
    <div style="font-size:44px;margin-bottom:10px;">üîí</div>
    <h3 style="margin-bottom:8px;">Managers Only</h3>
    <p class="meta">Enter password to access Final Authority.</p>
    <div class="toolbar" style="justify-content:center;margin-top:14px;">
      <input class="input" id="manager-pass" placeholder="Password" type="password" style="width:260px"/>
    </div>
    <div class="modal-actions">
      <button class="btn btn-primary" id="manager-enter">Enter</button>
      <button class="btn" id="manager-cancel">Cancel</button>
    </div>
    <p class="meta warn" id="manager-error" style="display:none;margin-top:10px;">Incorrect password.</p>
  </div>
</div>

<footer>
  <p>The Apex Sales System</p>
  <p style="margin-top:8px;">Power proves itself most clearly when it is not used.</p>
</footer>

<script>
  // -----------------------------
  // CONFIG
  // -----------------------------
  const MANAGER_PASSWORD = "coffee";

  // -----------------------------
  // STATE + DATA
  // -----------------------------
  const state = {
    currentPage: "home",
    currentDay: 1,
    completedDays: new Set(),
    managerAuthorized: false,
    dayFilter: ""
  };

  const data = {
    apexDays: [],
    persuasion: [],
    appointment: [],
    authority: []
  };

  // -----------------------------
  // HELPERS
  // -----------------------------
  const $  = (sel) => document.querySelector(sel);
  const $$ = (sel) => document.querySelectorAll(sel);

  function assetUrl(filename){
    // robust for GitHub Pages subpaths
    return new URL(filename, window.location.href).toString();
  }

  function escapeHtml(s){
    return String(s ?? "")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;");
  }

  function toHtmlText(text){
    // preserve paragraphs and bullet lines
    const t = String(text ?? "").trim();
    if(!t) return "";
    const parts = t.split(/\n{2,}/g).map(p => p.trim()).filter(Boolean);
    return parts.map(p => `<p>${escapeHtml(p).replaceAll("\n","<br>")}</p>`).join("");
  }

  // -----------------------------
  // MANAGER MODAL
  // -----------------------------
  function openManagerModal(onSuccess){
    $('#manager-error').style.display = 'none';
    $('#manager-pass').value = '';
    $('#manager-modal').classList.add('active');
    setTimeout(()=>$('#manager-pass').focus(), 50);

    const enter = () => {
      const val = $('#manager-pass').value;
      if(val !== MANAGER_PASSWORD){
        $('#manager-error').style.display = 'block';
        return;
      }
      state.managerAuthorized = true;
      closeManagerModal();
      onSuccess?.();
    };

    const cancel = () => closeManagerModal();

    // one-time wiring per open
    const enterBtn = $('#manager-enter');
    const cancelBtn = $('#manager-cancel');
    const pass = $('#manager-pass');

    enterBtn.onclick = enter;
    cancelBtn.onclick = cancel;
    pass.onkeydown = (e)=>{ if(e.key === 'Enter') enter(); if(e.key==='Escape') cancel(); };
  }

  function closeManagerModal(){
    $('#manager-modal').classList.remove('active');
  }

  // -----------------------------
  // NAVIGATION
  // -----------------------------
  function navigateToPage(pageName){
    if(pageName === 'authority' && !state.managerAuthorized){
      openManagerModal(()=>navigateToPage('authority'));
      return;
    }

    $$('.page').forEach(p => p.classList.add('hidden'));
    const target = $(`#page-${pageName}`);
    if(target){
      target.classList.remove('hidden');
      target.classList.add('fade-in');
      setTimeout(()=>target.classList.remove('fade-in'), 300);
    }
    $$('.nav-link').forEach(a => a.classList.toggle('active', a.dataset.page === pageName));
    state.currentPage = pageName;
    window.scrollTo(0,0);
  }

  // Home cards
  $$('[data-jump]').forEach(btn=>{
    btn.addEventListener('click', ()=> navigateToPage(btn.dataset.jump));
  });

  // Top nav links
  $$('.nav-link').forEach(link=>{
    link.addEventListener('click', (e)=>{
      e.preventDefault();
      navigateToPage(link.dataset.page);
    });
  });

  // -----------------------------
  // APEX: DAILY RENDER
  // -----------------------------
  function updateProgressRing(day){
    const circumference = 339.292;
    const progress = (day / 90) * circumference;
    const offset = circumference - progress;
    $('#progress-circle').style.strokeDashoffset = offset;
  }

  function getFilteredDays(){
    const q = (state.dayFilter || "").trim().toLowerCase();
    if(!q) return data.apexDays;
    return data.apexDays.filter(d => {
      const hay = `${d.day} ${d.title} ${d.signal} ${d.misread} ${d.diagnosis} ${d.safeLanguage} ${d.practice} ${d.check}`.toLowerCase();
      return hay.includes(q);
    });
  }

  function generateDayList(){
    const list = $('#day-list');
    const days = getFilteredDays();
    list.innerHTML = days.map(d=>{
      let cls = "day-list-item";
      if(state.completedDays.has(d.day)) cls += " completed";
      if(d.day === state.currentDay) cls += " current";
      return `<li class="${cls}" data-day="${d.day}">Day ${d.day}: ${escapeHtml(d.title || "")}</li>`;
    }).join("");

    $$('#day-list [data-day]').forEach(li=>{
      li.addEventListener('click', ()=>{
        const day = Number(li.dataset.day);
        loadDay(day);
      });
    });
  }

  function loadDay(dayNumber){
    state.currentDay = dayNumber;

    const dayObj = data.apexDays.find(d => Number(d.day) === Number(dayNumber)) || {
      day: dayNumber,
      title: `Day ${dayNumber}`,
      signal: "Content not found. Make sure apex_days.json is present and valid.",
      misread: "",
      diagnosis: "",
      interrupt: [],
      safeLanguage: "",
      practice: "",
      check: ""
    };

    $('#current-day-display').textContent = `DAY ${dayNumber}`;

    const interruptList = Array.isArray(dayObj.interrupt) ? dayObj.interrupt : [];
    const html = `
      <h2 style="margin-bottom: 26px;">${escapeHtml(dayObj.title || "")}</h2>

      <div class="content-block">
        <h4>The Signal</h4>
        ${toHtmlText(dayObj.signal)}
      </div>

      <div class="content-block">
        <h4>The Misread</h4>
        ${toHtmlText(dayObj.misread)}
      </div>

      <div class="content-block">
        <h4>The Correct Diagnosis</h4>
        ${toHtmlText(dayObj.diagnosis)}
      </div>

      <div class="content-block">
        <h4>The Interrupt</h4>
        <ul>${interruptList.map(i=>`<li>${escapeHtml(i)}</li>`).join("")}</ul>
      </div>

      <div class="content-block">
        <h4>The Safe Language</h4>
        <div class="quote">${escapeHtml(dayObj.safeLanguage || "")}</div>
      </div>

      <div class="content-block">
        <h4>The Practice</h4>
        ${toHtmlText(dayObj.practice)}
      </div>

      <div class="content-block">
        <h4>The Check</h4>
        <p style="font-style:italic;color:#9B9B9B;">${escapeHtml(dayObj.check || "")}</p>
      </div>

      <div class="nav-controls">
        <button class="btn" id="prev-day" ${dayNumber===1?'disabled':''}>‚Üê Previous</button>

        <label class="checkbox-label">
          <input type="checkbox" id="day-complete-check">
          <span>Mark Complete</span>
        </label>

        <button class="btn" id="next-day" ${dayNumber===90?'disabled':''}>Next ‚Üí</button>
      </div>
    `;
    $('#daily-content').innerHTML = html;

    updateProgressRing(dayNumber);
    generateDayList();

    // wire controls
    const complete = $('#day-complete-check');
    complete.checked = state.completedDays.has(dayNumber);
    complete.onchange = (e)=>{
      if(e.target.checked) state.completedDays.add(dayNumber);
      else state.completedDays.delete(dayNumber);
      generateDayList();
    };

    $('#next-day').onclick = ()=>{ if(dayNumber<90) loadDay(dayNumber+1); };
    $('#prev-day').onclick = ()=>{ if(dayNumber>1) loadDay(dayNumber-1); };
  }

  // Apex start
  $('#start-day-1').addEventListener('click', ()=>{
    navigateToPage('daily');
    loadDay(1);
  });

  $('#day-search').addEventListener('input', (e)=>{
    state.dayFilter = e.target.value || "";
    generateDayList();
  });

  // -----------------------------
  // CHAPTER PAGES
  // -----------------------------
  function renderChapterList(kind, chapters){
    const listEl = $(`#${kind}-list`);
    const panelEl = $(`#${kind}-panel`);

    listEl.innerHTML = chapters.map((c, idx)=>{
      const title = c.title || c.name || `Chapter ${idx+1}`;
      return `<li data-idx="${idx}">${escapeHtml(title)}</li>`;
    }).join("");

    const setActive = (idx)=>{
      $$('#'+kind+'-list li').forEach(li=>li.classList.remove('active'));
      const li = $(`#${kind}-list li[data-idx="${idx}"]`);
      if(li) li.classList.add('active');

      const c = chapters[idx];
      if(!c){
        panelEl.innerHTML = `<p class="meta">Select a chapter.</p>`;
        return;
      }
      const title = escapeHtml(c.title || c.name || "");
      const body = toHtmlText(c.content || c.body || "");
      panelEl.innerHTML = `<h3 style="margin-bottom:10px;">${title}</h3>${body || '<p class="meta">No content.</p>'}`;
    };

    // click wiring
    $$('#'+kind+'-list li').forEach(li=>{
      li.addEventListener('click', ()=>{
        setActive(Number(li.dataset.idx));
      });
    });

    // default select first if exists
    if(chapters.length) setActive(0);
  }

  function wireChapterSearch(kind, chapters){
    const input = $(`#${kind}-search`);
    if(!input) return;

    input.addEventListener('input', ()=>{
      const q = (input.value || "").trim().toLowerCase();
      const filtered = !q ? chapters : chapters.filter(c=>{
        const hay = `${c.title||""} ${c.content||""}`.toLowerCase();
        return hay.includes(q);
      });
      renderChapterList(kind, filtered);
    });
  }

  // -----------------------------
  // CONTENT LOADING
  // -----------------------------
  async function loadAllContent(){
    const status = $('#load-status');
    const files = [
      {key:'apexDays', url: assetUrl('apex_days.json')},
      {key:'persuasion', url: assetUrl('deep_persuasion.json')},
      {key:'appointment', url: assetUrl('appointment.json')},
      {key:'authority', url: assetUrl('final_authority.json')},
    ];

    const [apexRes, persRes, apptRes, authRes] = await Promise.all(files.map(f => fetch(f.url, {cache:'no-store'})));

    if(!apexRes.ok || !persRes.ok || !apptRes.ok || !authRes.ok){
      throw new Error(`Fetch failed. apex=${apexRes.status} persuasion=${persRes.status} appointment=${apptRes.status} authority=${authRes.status}`);
    }

    const apexJson = await apexRes.json();
    const persJson = await persRes.json();
    const apptJson = await apptRes.json();
    const authJson = await authRes.json();

    data.apexDays = (apexJson.days || []).map(d => ({...d, day:Number(d.day)})).sort((a,b)=>a.day-b.day);
    data.persuasion = (persJson.chapters || []);
    data.appointment = (apptJson.chapters || []);
    data.authority = (authJson.chapters || []);

    $('#apex-count').textContent = `Days loaded: ${data.apexDays.length}`;

    // initial lists
    generateDayList();
    loadDay(1);

    renderChapterList('pers', data.persuasion);
    renderChapterList('appt', data.appointment);
    renderChapterList('auth', data.authority);

    wireChapterSearch('pers', data.persuasion);
    wireChapterSearch('appt', data.appointment);
    wireChapterSearch('auth', data.authority);

    status.textContent = `Loaded: Apex ${data.apexDays.length} days ‚Ä¢ Deep Persuasion ${data.persuasion.length} chapters ‚Ä¢ Appointment ${data.appointment.length} chapters ‚Ä¢ Final Authority ${data.authority.length} chapters`;
  }

  (async function init(){
    try{
      await loadAllContent();
      navigateToPage('home');
    }catch(err){
      console.error(err);
      $('#load-status').innerHTML = `<span class="warn">Could not load content.</span> Make sure <strong>apex_days.json</strong>, <strong>deep_persuasion.json</strong>, <strong>appointment.json</strong>, and <strong>final_authority.json</strong> are in the <em>same folder</em> as <strong>index.html</strong>.`;
      navigateToPage('home');
    }
  })();
</script>
</body>
</html>
