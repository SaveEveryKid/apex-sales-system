<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Apex Sales System</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Inter','SF Pro',system-ui,sans-serif;background:#2B2D31;color:#E8E8E8;line-height:1.7;font-size:18px}
    h1{font-size:42px;font-weight:600;letter-spacing:-0.02em;line-height:1.2}
    h2{font-size:32px;font-weight:500;margin-bottom:1.5em}
    h3{font-size:24px;font-weight:500;margin-bottom:1em}
    p{margin-bottom:1.2em}
    .meta{font-size:14px;color:#9B9B9B}
    .container{max-width:1200px;margin:0 auto;padding:0 40px}
    .content-narrow{max-width:680px;margin:0 auto}
    section{padding:120px 0}
    header{background:rgba(43,45,49,0.95);backdrop-filter:blur(10px);position:sticky;top:0;z-index:1000;border-bottom:1px solid rgba(155,155,155,0.1)}
    nav{display:flex;justify-content:space-between;align-items:center;padding:24px 40px}
    .logo{font-size:14px;font-weight:600;letter-spacing:0.05em;text-transform:uppercase}
    .nav-links{display:flex;gap:32px;list-style:none}
    .nav-links a{color:#9B9B9B;text-decoration:none;font-size:14px;transition:color 200ms ease}
    .nav-links a:hover{color:#E8E8E8}
    .nav-links a.active{color:#E8E8E8}
    .hero{text-align:center;padding:160px 0 120px}
    .hero-title{margin-bottom:24px}
    .hero-divider{width:200px;height:1px;background:#9B9B9B;margin:32px auto}
    .hero-subtitle{font-size:20px;color:#9B9B9B;font-weight:400}
    .hero-tagline{font-size:14px;color:#9B9B9B;margin-top:16px;font-style:italic}
    .systems-grid{display:grid;gap:32px;margin-top:80px}
    .system-card{background:rgba(255,255,255,0.03);border:1px solid rgba(155,155,155,0.1);padding:48px;transition:border-color 200ms ease}
    .system-card:hover{border-color:rgba(155,155,155,0.2)}
    .system-card.locked{opacity:0.5}
    .card-header{display:flex;align-items:center;gap:16px;margin-bottom:24px}
    .card-icon{font-size:32px}
    .card-title{font-size:24px;font-weight:600}
    .card-description{color:#9B9B9B;margin-bottom:16px}
    .card-status{font-size:14px;color:#9B9B9B;font-style:italic}
    .btn{display:inline-block;padding:16px 32px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:#E8E8E8;text-decoration:none;font-size:16px;transition:all 200ms ease;cursor:pointer}
    .btn:hover:not(:disabled){background:rgba(255,255,255,0.08);border-color:rgba(255,255,255,0.2)}
    .btn:disabled{opacity:0.3;cursor:not-allowed}
    .btn-primary{background:rgba(91,124,153,0.2);border-color:#5B7C99}
    .btn-primary:hover:not(:disabled){background:rgba(91,124,153,0.3)}
    blockquote{background:rgba(255,255,255,0.02);border-left:2px solid #5B7C99;padding:32px;margin:32px 0;font-style:italic}
    footer{border-top:1px solid rgba(155,155,155,0.1);padding:60px 40px;text-align:center;font-size:14px;color:#9B9B9B}
    .hidden{display:none}
    .fade-in{animation:fadeIn 400ms ease-in}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

    /* Layout shells */
    .two-col{display:grid;grid-template-columns:280px 1fr;gap:80px;padding:60px 40px}
    .sidebar{position:sticky;top:100px;height:fit-content}
    .sidebar h3{margin-bottom:16px}
    .list{list-style:none}
    .list-item{padding:10px 0;color:#9B9B9B;font-size:14px;cursor:pointer;border-bottom:1px solid rgba(155,155,155,0.06)}
    .list-item:hover{color:#E8E8E8}
    .list-item.current{color:#E8E8E8;font-weight:600}
    .search{width:100%;padding:12px 14px;background:rgba(255,255,255,0.04);border:1px solid rgba(155,155,155,0.12);color:#E8E8E8;font-size:14px;outline:none;margin:10px 0 18px}
    .search::placeholder{color:#9B9B9B}
    .content{max-width:740px}
    .content-block{margin-bottom:48px}
    .content-block h3{color:#5B7C99;font-size:14px;text-transform:uppercase;letter-spacing:0.1em;margin-bottom:16px}
    .content-block ul{margin-left:24px;margin-bottom:1.5em}
    .content-block li{margin-bottom:8px}
    .quote{font-style:italic;color:#9B9B9B;padding-left:24px;border-left:2px solid #5B7C99;margin:24px 0}
    .nav-controls{display:flex;justify-content:space-between;align-items:center;margin-top:80px;padding-top:40px;border-top:1px solid rgba(155,155,155,0.1)}
    .checkbox-label{display:flex;align-items:center;gap:12px;cursor:pointer;font-size:16px}
    .checkbox-label input{width:20px;height:20px;cursor:pointer}

    /* Daily ring */
    .day-counter{font-size:48px;font-weight:600;margin-bottom:24px;color:#5B7C99}
    .progress-ring{width:120px;height:120px;margin-bottom:32px}

    /* Modal */
    .modal{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.9);z-index:2000;align-items:center;justify-content:center}
    .modal.active{display:flex}
    .modal-content{background:#2B2D31;border:1px solid #8B5A5A;max-width:600px;padding:60px;text-align:center}
    .modal-icon{font-size:48px;margin-bottom:24px}
    .modal h2{color:#8B5A5A;margin-bottom:32px}
    .modal-actions{display:flex;gap:16px;justify-content:center;margin-top:40px}

    /* Notices */
    .notice{background:rgba(255,255,255,0.02);border-left:2px solid rgba(155,155,155,0.35);padding:24px;margin:24px 0;color:#9B9B9B}
    .notice strong{color:#E8E8E8}
  </style>
</head>
<body>
  <header>
    <nav>
      <div class="logo">The Apex Sales System</div>
      <ul class="nav-links">
        <li><a href="#home" class="active nav-link" data-page="home">Home</a></li>
        <li><a href="#apex" class="nav-link" data-page="apex">Apex Training</a></li>
        <li><a href="#persuasion" class="nav-link" data-page="persuasion">Deep Persuasion</a></li>
        <li><a href="#appointment" class="nav-link" data-page="appointment">Appointment</a></li>
        <li><a href="#authority" class="nav-link" data-page="authority">Final Authority</a></li>
      </ul>
    </nav>
  </header>

  <main id="app">
    <!-- HOME PAGE -->
    <div id="page-home" class="page active">
      <section class="hero">
        <div class="container">
          <h1 class="hero-title">THE APEX SALES SYSTEM</h1>
          <div class="hero-divider"></div>
          <p class="hero-subtitle">Human Decision Architecture</p>
          <p class="hero-tagline">Train perception. Preserve agency. Use skill responsibly.</p>
        </div>
      </section>

      <section>
        <div class="container">
          <div class="content-narrow">
            <h2>What This Is</h2>
            <blockquote>
              <p><strong>This is not a sales course.</strong></p>
              <p>This is a <strong>training environment</strong> designed to upgrade perception, communication, and decision quality.</p>
              <p>Use it to become more effective ‚Äî and more responsible.</p>
            </blockquote>
          </div>
        </div>
      </section>

      <section>
        <div class="container">
          <h2 style="text-align:center; margin-bottom:60px;">The Four Systems</h2>

          <div class="systems-grid">
            <div class="system-card">
              <div class="card-header">
                <div class="card-icon">üî∞</div>
                <div><h3 class="card-title">APEX TRAINING</h3></div>
              </div>
              <p class="card-description">90-day daily training system: perception, self-regulation, clean influence.</p>
              <p class="card-status">üîí Managers Only ‚Äî Password Required</p>
              <div style="margin-top:24px;">
                <button class="btn btn-primary" id="begin-apex">Go to Apex Training</button>
              </div>
            </div>

            <div class="system-card">
              <div class="card-header">
                <div class="card-icon">üéØ</div>
                <div><h3 class="card-title">DEEP PERSUASION</h3></div>
              </div>
              <p class="card-description">Advanced decision-layer skill for sales teams.</p>
              <p class="card-status">Accessible to all</p>
            </div>

            <div class="system-card">
              <div class="card-header">
                <div class="card-icon">üö™</div>
                <div><h3 class="card-title">THE APPOINTMENT IS THE DECISION</h3></div>
              </div>
              <p class="card-description">Appointment-setting architecture: clarity, safety, and commitment.</p>
              <p class="card-status">Accessible to all</p>
            </div>

            <div class="system-card">
              <div class="card-header">
                <div class="card-icon">‚öñÔ∏è</div>
                <div><h3 class="card-title">FINAL AUTHORITY</h3></div>
              </div>
              <p class="card-description">Manager framework for decision resolution under pressure.</p>
              <p class="card-status">Accessible to all</p>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- APEX TRAINING OVERVIEW -->
    <div id="page-apex" class="page hidden">
      <section class="hero" style="padding:100px 0 60px;">
        <div class="container">
          <div style="text-align:center;">
            <div style="font-size:48px; margin-bottom:16px;">üî∞</div>
            <h1>APEX TRAINING</h1>
            <div class="hero-divider"></div>
            <p class="hero-subtitle">90-Day Devotional for Sales Teams</p>
            <p class="hero-tagline">One day per day. No rush. Real reps.</p>
          </div>
        </div>
      </section>

      <section>
        <div class="container">
          <div class="content-narrow">
            <h2>How to Use This</h2>
            <ul>
              <li>Read one day.</li>
              <li>Apply it in real conversations.</li>
              <li>Mark it complete.</li>
              <li>Repeat tomorrow.</li>
            </ul>

            <div style="text-align:center; margin-top:60px;">
              <button class="btn btn-primary" id="start-day-1">Begin Day 1</button>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- DAILY CONTENT -->
    <div id="page-daily" class="page hidden">
      <div class="daily-layout">
        <div class="sidebar">
          <div class="day-counter" id="current-day-display">DAY 1</div>
          <svg class="progress-ring" viewBox="0 0 120 120">
            <circle cx="60" cy="60" r="54" fill="none" stroke="rgba(155,155,155,0.1)" stroke-width="4"/>
            <circle id="progress-circle" cx="60" cy="60" r="54" fill="none" stroke="#5B7C99" stroke-width="4"
              stroke-dasharray="339.292" stroke-dashoffset="339.292" transform="rotate(-90 60 60)"/>
          </svg>
          <input class="search" id="day-search" placeholder="Search days..." />
          <ul class="day-list" id="day-list"></ul>
        </div>

        <div class="daily-content" id="daily-content"></div>
      </div>
    </div>

    <!-- DEEP PERSUASION -->
    <div id="page-persuasion" class="page hidden">
      <div class="two-col">
        <div class="sidebar">
          <h3>Deep Persuasion</h3>
          <input class="search" id="pers-search" placeholder="Search chapters..." />
          <ul class="list" id="pers-list"></ul>
        </div>
        <div class="content" id="pers-content"></div>
      </div>
    </div>

    <!-- APPOINTMENT -->
    <div id="page-appointment" class="page hidden">
      <div class="two-col">
        <div class="sidebar">
          <h3>Appointment</h3>
          <input class="search" id="appt-search" placeholder="Search chapters..." />
          <ul class="list" id="appt-list"></ul>
        </div>
        <div class="content" id="appt-content"></div>
      </div>
    </div>

    <!-- FINAL AUTHORITY -->
    <div id="page-authority" class="page hidden">
      <div class="two-col">
        <div class="sidebar">
          <h3>Final Authority</h3>
          <input class="search" id="auth-search" placeholder="Search chapters..." />
          <ul class="list" id="auth-list"></ul>
        </div>
        <div class="content" id="auth-content"></div>
      </div>
    </div>
  </main>

  <footer>
    <p>The Apex Sales System</p>
    <p style="margin-top:8px;">Train skill. Keep integrity.</p>
  </footer>

  <script>
// -----------------------------
    // DATA
    // -----------------------------
    const data = {
      apexDays: null,
      persuasion: null,
      appointment: null,
      authority: null,
    };

    const state = {
    managerAuthorized: false,
      currentPage: 'home',
      currentDay: 1,
      completedDays: new Set(),
      dayFilter: '',
    };

    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => document.querySelectorAll(sel);

    function escapeHtml(str) {
      return String(str ?? '')
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;');
    }

    function toPlainForSearch(obj) {
      return JSON.stringify(obj ?? '').toLowerCase();
    }

    async function loadAllContent() {
      const [apexRes, persRes, apptRes, authRes] = await Promise.all([
        fetch('./apex_days.json', {cache:'no-store'}),
        fetch('./deep_persuasion.json', {cache:'no-store'}),
        fetch('./appointment.json', {cache:'no-store'}),
        fetch('./final_authority.json', {cache:'no-store'}),
      ]);

      data.apexDays = (await apexRes.json()).days || [];
      data.persuasion = (await persRes.json()).chapters || [];
      data.appointment = (await apptRes.json()).chapters || [];
      data.authority = (await authRes.json()).chapters || [];

      // build lists once loaded
      generateDayList();
      renderChapterList('pers', data.persuasion);
      renderChapterList('appt', data.appointment);
      renderChapterList('auth', data.authority);

      // default selections
      if (data.persuasion.length) renderChapter('pers', data.persuasion[0]);
      if (data.appointment.length) renderChapter('appt', data.appointment[0]);
      if (data.authority.length) renderChapter('auth', data.authority[0]);
    }

    // -----------------------------
    // NAVIGATION (no gating)
    // -----------------------------
    function navigateToPage(pageName) {
      // Password protection for managers-only training
      if (pageName === 'authority' && !state.managerAuthorized) {
        const entered = prompt('Managers Only ‚Äî Enter Password:');
        if (entered !== MANAGER_PASSWORD) {
          alert('Access denied.');
          pageName = 'home';
        } else {
          state.managerAuthorized = true;
        }
      }
      $$('.page').forEach(page => {
        page.classList.add('hidden');
        page.classList.remove('active', 'fade-in');
      });

      const target = $(`#page-${pageName}`);
      if (target) {
        target.classList.remove('hidden');
        target.classList.add('active');
        requestAnimationFrame(() => target.classList.add('fade-in'));
      }

      $$('.nav-link').forEach(link => {
        link.classList.toggle('active', link.dataset.page === pageName);
      });

      state.currentPage = pageName;
      window.scrollTo(0, 0);
    }

    // -----------------------------
    // APEX DAILY
    // -----------------------------
    function updateProgressRing(currentDay) {
      const circumference = 339.292;
      const progress = (currentDay / 90) * circumference;
      const offset = circumference - progress;
      const circle = $('#progress-circle');
      if (circle) circle.style.strokeDashoffset = offset;
    }

    function generateDayList() {
      const list = $('#day-list');
      if (!list || !data.apexDays) return;

      const filter = (state.dayFilter || '').toLowerCase().trim();

      const days = data.apexDays.filter(d => {
        if (!filter) return true;
        return toPlainForSearch(d).includes(filter);
      });

      list.innerHTML = days.map(d => {
        const day = d.day;
        let className = 'day-list-item';
        if (state.completedDays.has(day)) className += ' completed';
        if (day === state.currentDay) className += ' current';
        return `<li class="${className}" data-day="${day}">Day ${day}</li>`;
      }).join('');

      $$('#day-list .day-list-item').forEach(item => {
        item.addEventListener('click', () => loadDay(Number(item.dataset.day)));
      });
    }

    function loadDay(dayNumber) {
      state.currentDay = dayNumber;

      const dayObj = (data.apexDays || []).find(d => d.day === dayNumber) || {
        day: dayNumber,
        title: `Day ${dayNumber}`,
        signal: "Content not found.",
        misread: "",
        diagnosis: "",
        interrupt: [],
        safeLanguage: "",
        practice: "",
        check: ""
      };

      $('#current-day-display').textContent = `DAY ${dayNumber}`;

      $('#daily-content').innerHTML = `
        <h2 style="margin-bottom: 60px;">${escapeHtml(dayObj.title)}</h2>

        <div class="content-block"><h3>The Signal</h3><p>${escapeHtml(dayObj.signal)}</p></div>
        <div class="content-block"><h3>The Misread</h3><p>${escapeHtml(dayObj.misread)}</p></div>
        <div class="content-block"><h3>The Correct Diagnosis</h3><p>${escapeHtml(dayObj.diagnosis)}</p></div>

        <div class="content-block">
          <h3>The Interrupt</h3>
          <ul>${(dayObj.interrupt || []).map(i => `<li>${escapeHtml(i)}</li>`).join('')}</ul>
        </div>

        <div class="content-block"><h3>The Safe Language</h3><p class="quote">${escapeHtml(dayObj.safeLanguage)}</p></div>
        <div class="content-block"><h3>The Practice</h3><p>${escapeHtml(dayObj.practice)}</p></div>
        <div class="content-block"><h3>The Check</h3><p style="font-style: italic; color: #9B9B9B;">${escapeHtml(dayObj.check)}</p></div>

        <div class="nav-controls">
          <button class="btn" id="prev-day" ${dayNumber === 1 ? 'disabled' : ''}>‚Üê Previous Day</button>

          <label class="checkbox-label">
            <input type="checkbox" id="day-complete-check">
            <span>Mark as Complete</span>
          </label>

          <button class="btn" id="next-day" ${dayNumber === 90 ? 'disabled' : ''}>Next Day ‚Üí</button>
        </div>
      `;

      updateProgressRing(dayNumber);

      // wire controls
      const completeCheck = $('#day-complete-check');
      const nextBtn = $('#next-day');
      const prevBtn = $('#prev-day');

      completeCheck.checked = state.completedDays.has(dayNumber);

      completeCheck.addEventListener('change', (e) => {
        if (e.target.checked) state.completedDays.add(dayNumber);
        else state.completedDays.delete(dayNumber);
        generateDayList();
      });

      nextBtn.addEventListener('click', () => {
        if (dayNumber < 90) loadDay(dayNumber + 1);
      });

      prevBtn.addEventListener('click', () => {
        if (dayNumber > 1) loadDay(dayNumber - 1);
      });

      generateDayList();
    }

    // -----------------------------
    // CHAPTER PAGES
    // -----------------------------
    function renderChapterList(prefix, chapters) {
      const listEl = $(`#${prefix}-list`);
      if (!listEl) return;

      listEl.innerHTML = (chapters || []).map(ch => {
        const label = `${ch.number}. ${ch.title}`;
        return `<li class="list-item" data-n="${ch.number}">${escapeHtml(label)}</li>`;
      }).join('');

      $$(`#${prefix}-list .list-item`).forEach(item => {
        item.addEventListener('click', () => {
          const n = Number(item.dataset.n);
          const ch = (chapters || []).find(c => c.number === n);
          if (ch) renderChapter(prefix, ch);
        });
      });
    }

    function renderChapter(prefix, chapter) {
      const contentEl = $(`#${prefix}-content`);
      if (!contentEl) return;

      // highlight current
      $$(`#${prefix}-list .list-item`).forEach(li => {
        li.classList.toggle('current', Number(li.dataset.n) === chapter.number);
      });

      const title = `${chapter.number}. ${chapter.title}`;
      const body = (chapter.content || '').split('\n').map(line => {
        const t = line.trim();
        if (!t) return '<p style="margin-bottom: 1.2em;"></p>';
        if (t.startsWith('# ')) return `<h2>${escapeHtml(t.replace(/^#\s+/, ''))}</h2>`;
        if (t.startsWith('## ')) return `<h3 style="margin-top: 32px;">${escapeHtml(t.replace(/^##\s+/, ''))}</h3>`;
        if (t.startsWith('- ')) return `<li>${escapeHtml(t.replace(/^-\s+/, ''))}</li>`;
        return `<p>${escapeHtml(t)}</p>`;
      });

      // wrap consecutive <li> into <ul>
      const wrapped = [];
      let inList = false;
      for (const chunk of body) {
        if (chunk.startsWith('<li>')) {
          if (!inList) {
            wrapped.push('<ul style="margin-left:24px; margin-bottom:1.5em;">');
            inList = true;
          }
          wrapped.push(chunk);
        } else {
          if (inList) {
            wrapped.push('</ul>');
            inList = false;
          }
          wrapped.push(chunk);
        }
      }
      if (inList) wrapped.push('</ul>');

      contentEl.innerHTML = `
        <div class="content-narrow">
          <h2 style="margin-bottom: 40px;">${escapeHtml(title)}</h2>
          ${wrapped.join('')}
        </div>
      `;
    }

    function wireSearch(prefix, chapters) {
      const input = $(`#${prefix}-search`);
      if (!input) return;

      input.addEventListener('input', () => {
        const q = input.value.toLowerCase().trim();
        const filtered = (chapters || []).filter(ch => toPlainForSearch(ch).includes(q));
        renderChapterList(prefix, filtered);
        if (filtered.length) renderChapter(prefix, filtered[0]);
        else {
          const contentEl = $(`#${prefix}-content`);
          if (contentEl) contentEl.innerHTML = `<div class="content-narrow"><h2>No results</h2><p>Try a different search.</p></div>`;
        }
      });
    }

    // -----------------------------
    // EVENTS
    // -----------------------------
    $$('.nav-link').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        navigateToPage(link.dataset.page);
      });
    });

    $('#begin-apex')?.addEventListener('click', () => navigateToPage('apex'));
    $('#start-day-1')?.addEventListener('click', () => {
      navigateToPage('daily');
      loadDay(1);
    });

    $('#day-search')?.addEventListener('input', (e) => {
      state.dayFilter = e.target.value || '';
      generateDayList();
    });

    // -----------------------------
    // INIT
    // -----------------------------
    (async function init() {
      try {
        await loadAllContent();

        // wire searches once content loaded
        wireSearch('pers', data.persuasion);
        wireSearch('appt', data.appointment);
        wireSearch('auth', data.authority);

        // load day 1 for daily page pre-render
        loadDay(1);
      } catch (err) {
        console.error(err);
        // fallback message on home
        const home = $('#page-home');
        if (home) {
          const div = document.createElement('div');
          div.className = 'container';
          div.innerHTML = `<p style="color:#8B5A5A; padding: 0 40px 80px;">Could not load JSON content. Make sure apex_days.json, deep_persuasion.json, appointment.json, and final_authority.json are in the same folder as index.html.</p>`;
          home.appendChild(div);
        }
      }
    })();
</script>
</body>
</html>
